<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ArbiInvest - –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π</title>
    
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #0f0f0f;
            color: #e0e0e0;
            padding: 40px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #fff;
            margin-bottom: 30px;
        }
        
        .check-list {
            background: #1a1a1a;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .check-item {
            display: flex;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #242424;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .check-item.loading {
            opacity: 0.6;
        }
        
        .check-item.success {
            background: rgba(16, 185, 129, 0.1);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        
        .check-item.error {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        
        .status-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }
        
        .check-name {
            flex: 1;
            font-weight: 500;
        }
        
        .check-status {
            font-size: 14px;
            color: #808080;
        }
        
        .success .check-status {
            color: #10b981;
        }
        
        .error .check-status {
            color: #ef4444;
        }
        
        .console-output {
            background: #0d0d0d;
            border: 1px solid #2a2a2a;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .console-line {
            margin: 2px 0;
            padding: 2px 0;
        }
        
        .console-success {
            color: #10b981;
        }
        
        .console-error {
            color: #ef4444;
        }
        
        .console-warning {
            color: #fbbf24;
        }
        
        .console-info {
            color: #3b82f6;
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: transform 0.2s;
        }
        
        button:hover {
            transform: translateY(-2px);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π ArbiInvest</h1>
    
    <div class="check-list" id="check-list">
        <div class="check-item loading" data-module="config">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–º–ø—É–ª–∞</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <div class="check-item loading" data-module="client">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">RPC –∫–ª–∏–µ–Ω—Ç</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <div class="check-item loading" data-module="decoder">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">–î–µ–∫–æ–¥–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <div class="check-item loading" data-module="ui">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <div class="check-item loading" data-module="main">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">–ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <div class="check-item loading" data-module="section">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">–°–µ–∫—Ü–∏—è –º–µ–º–ø—É–ª–∞</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
        <div class="check-item loading" data-module="rpc">
            <span class="status-icon">‚è≥</span>
            <span class="check-name">RPC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ</span>
            <span class="check-status">–ü—Ä–æ–≤–µ—Ä–∫–∞...</span>
        </div>
    </div>
    
    <div>
        <button id="test-init">–¢–µ—Å—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏</button>
        <button id="test-rpc">–¢–µ—Å—Ç RPC</button>
        <button id="test-decode">–¢–µ—Å—Ç –¥–µ–∫–æ–¥–µ—Ä–∞</button>
        <button id="clear-cache">–û—á–∏—Å—Ç–∏—Ç—å –∫—ç—à</button>
    </div>
    
    <div class="console-output" id="console">
        <div class="console-line console-info">üöÄ –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –º–æ–¥—É–ª–µ–π...</div>
    </div>
    
    <script type="module">
        const log = (message, type = 'info') => {
            const console = document.getElementById('console');
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;
            line.textContent = message;
            console.appendChild(line);
            console.scrollTop = console.scrollHeight;
        };
        
        const updateCheck = (module, status, message) => {
            const item = document.querySelector(`[data-module="${module}"]`);
            if (!item) return;
            
            item.classList.remove('loading', 'success', 'error');
            item.classList.add(status);
            
            const icon = item.querySelector('.status-icon');
            const statusText = item.querySelector('.check-status');
            
            if (status === 'success') {
                icon.textContent = '‚úÖ';
                statusText.textContent = message || '–ó–∞–≥—Ä—É–∂–µ–Ω';
            } else if (status === 'error') {
                icon.textContent = '‚ùå';
                statusText.textContent = message || '–û—à–∏–±–∫–∞';
            }
        };
        
        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥—É–ª–µ–π
        const checkModules = async () => {
            log('üì¶ –ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–¥—É–ª–∏ –º–µ–º–ø—É–ª–∞...', 'info');
            
            // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
            try {
                const { MEMPOOL_CONFIG } = await import('./modules/mempool/config.js');
                if (MEMPOOL_CONFIG && MEMPOOL_CONFIG.RPC) {
                    updateCheck('config', 'success', '–ó–∞–≥—Ä—É–∂–µ–Ω');
                    log('‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                }
            } catch (error) {
                updateCheck('config', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
            
            // RPC –∫–ª–∏–µ–Ω—Ç
            try {
                const { mempoolClient } = await import('./modules/mempool/client.js');
                if (mempoolClient) {
                    updateCheck('client', 'success', '–ó–∞–≥—Ä—É–∂–µ–Ω');
                    log('‚úÖ RPC –∫–ª–∏–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                    const stats = mempoolClient.getStats();
                    log(`üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: RPC –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ ${stats.rpcUsedToday}, —Ä–µ–∂–∏–º ${stats.mode}`, 'info');
                }
            } catch (error) {
                updateCheck('client', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞: ${error.message}`, 'error');
            }
            
            // –î–µ–∫–æ–¥–µ—Ä
            try {
                const { txDecoder } = await import('./modules/mempool/decoder.js');
                if (txDecoder) {
                    updateCheck('decoder', 'success', '–ó–∞–≥—Ä—É–∂–µ–Ω');
                    log('‚úÖ –î–µ–∫–æ–¥–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                }
            } catch (error) {
                updateCheck('decoder', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–µ—Ä–∞: ${error.message}`, 'error');
            }
            
            // UI
            try {
                const { mempoolUI } = await import('./modules/mempool/ui.js');
                if (mempoolUI) {
                    updateCheck('ui', 'success', '–ó–∞–≥—Ä—É–∂–µ–Ω');
                    log('‚úÖ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                }
            } catch (error) {
                updateCheck('ui', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ UI: ${error.message}`, 'error');
            }
            
            // –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å
            try {
                const { initMempool } = await import('./modules/mempool/mempool.js');
                if (initMempool) {
                    updateCheck('main', 'success', '–ó–∞–≥—Ä—É–∂–µ–Ω');
                    log('‚úÖ –ì–ª–∞–≤–Ω—ã–π –º–æ–¥—É–ª—å –º–µ–º–ø—É–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω', 'success');
                }
            } catch (error) {
                updateCheck('main', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ –≥–ª–∞–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è: ${error.message}`, 'error');
            }
            
            // –°–µ–∫—Ü–∏—è
            try {
                const MempoolSection = (await import('./modules/mempool/mempool-section.js')).default;
                if (MempoolSection) {
                    updateCheck('section', 'success', '–ó–∞–≥—Ä—É–∂–µ–Ω');
                    log('‚úÖ –°–µ–∫—Ü–∏—è –º–µ–º–ø—É–ª–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞', 'success');
                }
            } catch (error) {
                updateCheck('section', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ —Å–µ–∫—Ü–∏–∏: ${error.message}`, 'error');
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ RPC
            try {
                log('üîó –ü—Ä–æ–≤–µ—Ä—è–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å RPC...', 'info');
                const response = await fetch('https://old-patient-butterfly.bsc.quiknode.pro/033086e8e5a0217bb0b15a808dd70bc4e3e025af', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 1,
                        method: 'eth_chainId',
                        params: []
                    })
                });
                
                const data = await response.json();
                if (data.result === '0x38') { // 56 –≤ hex
                    updateCheck('rpc', 'success', 'BSC Mainnet');
                    log('‚úÖ RPC —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ (BSC Mainnet)', 'success');
                } else {
                    throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π chain ID');
                }
            } catch (error) {
                updateCheck('rpc', 'error', error.message);
                log(`‚ùå –û—à–∏–±–∫–∞ RPC: ${error.message}`, 'error');
            }
            
            log('‚ú® –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!', 'success');
        };
        
        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkModules();
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–Ω–æ–ø–æ–∫
        document.getElementById('test-init').addEventListener('click', async () => {
            log('üöÄ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –º–µ–º–ø—É–ª–∞...', 'info');
            
            try {
                const { initMempool } = await import('./modules/mempool/mempool.js');
                
                // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                const container = document.createElement('div');
                container.id = 'test-mempool-container';
                container.style.display = 'none';
                document.body.appendChild(container);
                
                const result = initMempool('test-mempool-container');
                
                if (result) {
                    log('‚úÖ –ú–µ–º–ø—É–ª —É—Å–ø–µ—à–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!', 'success');
                } else {
                    log('‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –º–µ–º–ø—É–ª', 'error');
                }
                
                // –£–¥–∞–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
                setTimeout(() => {
                    container.remove();
                }, 1000);
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏: ${error.message}`, 'error');
            }
        });
        
        document.getElementById('test-rpc').addEventListener('click', async () => {
            log('üîó –¢–µ—Å—Ç–∏—Ä—É–µ–º RPC –≤—ã–∑–æ–≤—ã...', 'info');
            
            try {
                const { mempoolClient } = await import('./modules/mempool/client.js');
                
                log('üì¶ –ü–æ–ª—É—á–∞–µ–º pending –±–ª–æ–∫...', 'info');
                const block = await mempoolClient.getPendingBlock();
                
                if (block) {
                    log(`‚úÖ Pending –±–ª–æ–∫ –ø–æ–ª—É—á–µ–Ω, —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π: ${block.transactions?.length || 0}`, 'success');
                } else {
                    log('‚ö†Ô∏è Pending –±–ª–æ–∫ –ø—É—Å—Ç–æ–π', 'warning');
                }
                
                const stats = mempoolClient.getStats();
                log(`üìä RPC –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ: ${stats.rpcUsedToday}`, 'info');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ RPC: ${error.message}`, 'error');
            }
        });
        
        document.getElementById('test-decode').addEventListener('click', async () => {
            log('üîç –¢–µ—Å—Ç–∏—Ä—É–µ–º –¥–µ–∫–æ–¥–µ—Ä —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π...', 'info');
            
            try {
                const { txDecoder } = await import('./modules/mempool/decoder.js');
                
                // –¢–µ—Å—Ç–æ–≤–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è
                const testTx = {
                    hash: '0x123456789abcdef',
                    from: '0x742d35Cc6634C0532925a3b844Bc9e7595f0bEb4',
                    to: '0x10ED43C718714eb63d5aA57B78B54704E256024E', // PancakeSwap V2
                    value: '0x1bc16d674ec80000', // 2 BNB
                    gas: '0x5208',
                    gasPrice: '0x12a05f200', // 5 Gwei
                    input: '0x7ff36ab5', // swapExactETHForTokens
                    nonce: '0x10'
                };
                
                const decoded = txDecoder.decode(testTx);
                const formatted = txDecoder.formatTransaction(decoded);
                
                log(`‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –¥–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∞:`, 'success');
                log(`   –¢–∏–ø: ${formatted.type}`, 'info');
                log(`   DEX: ${formatted.dexName}`, 'info');
                log(`   –ú–µ—Ç–æ–¥: ${formatted.method}`, 'info');
                log(`   –°—É–º–º–∞: ${formatted.bnbValue} BNB`, 'info');
                log(`   Gas: ${formatted.gasPriceGwei} Gwei`, 'info');
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ –¥–µ–∫–æ–¥–µ—Ä–∞: ${error.message}`, 'error');
            }
        });
        
        document.getElementById('clear-cache').addEventListener('click', () => {
            localStorage.removeItem('mempool_rpc_usage');
            localStorage.removeItem('mempool_last_reset');
            localStorage.removeItem('mempool_seen_tx');
            log('üóëÔ∏è –ö—ç—à –æ—á–∏—â–µ–Ω', 'success');
        });
    </script>
</body>
</html>